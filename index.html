<!DOCTYPE html>
<html lang="gu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ› ï¸ àª•àª¾àª°à«€àª—àª° àª®àª¿àª¤à«àª° â€“ OTP PRO</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

<!-- Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<style>
body{margin:0;font-family:Arial;background:#f1f5f9}
header{background:#020617;color:#fff;padding:16px;text-align:center;font-size:20px}
.card{background:#fff;margin:14px;padding:16px;border-radius:18px;
box-shadow:0 10px 28px rgba(0,0,0,.12)}
input,select,button{
width:100%;padding:12px;margin:6px 0;
border-radius:12px;border:1px solid #cbd5e1
}
button{background:#2563eb;color:#fff;border:none;font-weight:bold}
.hidden{display:none}
.worker{
border:1px solid #e5e7eb;border-radius:14px;padding:12px;margin:10px 0
}
.actions button{
width:48%;margin:4px 1%;
}
.call{background:#16a34a}
.whatsapp{background:#22c55e}
.badge{background:#16a34a;color:white;padding:4px 10px;border-radius:10px;font-size:12px}
</style>
</head>

<body>

<header>ğŸ› ï¸ àª•àª¾àª°à«€àª—àª° àª®àª¿àª¤à«àª° â€“ OTP PRO</header>

<!-- ğŸ” OTP LOGIN -->
<div class="card" id="login">
<h3>ğŸ“± àª®à«‹àª¬àª¾àª‡àª² OTP Login</h3>
<input id="phone" placeholder="+91XXXXXXXXXX">
<div id="recaptcha"></div>
<button onclick="sendOTP()">OTP àª®à«‹àª•àª²à«‹</button>
<input id="otp" placeholder="OTP àª¦àª¾àª–àª² àª•àª°à«‹">
<button onclick="verifyOTP()">Verify</button>
</div>

<!-- ğŸ‘¤ WORKER PROFILE -->
<div class="card hidden" id="profile">
<h3>ğŸ‘¤ Worker Profile</h3>
<div id="pStatus"></div>
<input id="pName" placeholder="àª¨àª¾àª®">
<select id="pCity">
<option>Ahmedabad</option><option>Surat</option>
<option>Vadodara</option><option>Rajkot</option>
<option>Rural</option>
</select>
<select id="pCategory"></select>
<button onclick="saveProfile()">Save Profile</button>
</div>

<!-- ğŸ” NEARBY WORKERS -->
<div class="card">
<h3>ğŸ“ Nearby Approved Workers</h3>
<div id="nearby"></div>
</div>

<script>
// ğŸ”¥ FIREBASE
firebase.initializeApp({
 apiKey:"AIzaSyCTk0sFvZmY6olGOHwK59z-TYoSSj8_l0o",
 authDomain:"karigar-mitra-9c6be.firebaseapp.com",
 projectId:"karigar-mitra-9c6be"
});
const auth=firebase.auth();
const db=firebase.firestore();

// ğŸ“‚ CATEGORIES (FULL)
const CATEGORIES=[
'àª‡àª²à«‡àª•à«àªŸà«àª°à«€àª¶àª¿àª¯àª¨','àªªà«àª²àª®à«àª¬àª°','CCTV àª‡àª¨à«àª¸à«àªŸà«‹àª²à«‡àª¶àª¨','àª®àª¾àª² àª¹à«‡àª°àª«à«‡àª°',
'àª¸à«àª¥àª¾àª°à«€ àª•àª¾àª®','AC àª°à«€àªªà«‡àª°à«€àª‚àª—','àª®àª¿àª•à«‡àª¨àª¿àª•','àª•àª®à«àªªà«àª¯à«àªŸàª° àªàª¨à«àªœàª¿.',
'àªªà«‡àª‡àª¨à«àªŸàª¿àª‚àª—','àª¸àª«àª¾àªˆ àª•àª¾àª®','àªŸàª¾àªˆàª²à«àª¸ àª•àª¾àª®','àªµà«‡àª²à«àª¡àª¿àª‚àª—',
'àªªà«‡àª¸à«àªŸ àª•àª‚àªŸà«àª°à«‹àª²','àªŸà«€àªµà«€ àª°à«€àªªà«‡àª°à«€àª‚àª—','àª—à«àª²àª¾àª¸ àª«àª¿àªŸàª¿àª‚àª—','àª¬àª¾àª°à«€-àª¬àª¾àª°àª£àª¾'
];
CATEGORIES.forEach(c=>{
 let o=document.createElement("option");
 o.value=o.innerText=c;
 pCategory.appendChild(o);
});

// ğŸ” OTP AUTH
window.recaptchaVerifier=new firebase.auth.RecaptchaVerifier('recaptcha',{size:'normal'});
let confirmation;

function sendOTP(){
 auth.signInWithPhoneNumber(phone.value,window.recaptchaVerifier)
 .then(c=>{confirmation=c;alert("OTP àª®à«‹àª•àª²àª¾àª¯à«‹");})
 .catch(e=>alert(e.message));
}
function verifyOTP(){
 confirmation.confirm(otp.value)
 .then(()=>loadProfile())
 .catch(()=>alert("Wrong OTP"));
}

// ğŸ‘¤ LOAD PROFILE
function loadProfile(){
 login.classList.add("hidden");
 profile.classList.remove("hidden");

 db.collection("workers")
 .where("uid","==",auth.currentUser.uid)
 .get()
 .then(s=>{
  if(!s.empty){
   let w=s.docs[0].data();
   pName.value=w.name;
   pCity.value=w.city;
   pCategory.value=w.category;
   pStatus.innerHTML=`Status:
   <span class="badge">${w.approved?"Approved":"Pending"}</span>`;
  }
 });
}

// ğŸ’¾ SAVE PROFILE
function saveProfile(){
 navigator.geolocation.getCurrentPosition(p=>{
  db.collection("workers").add({
   uid:auth.currentUser.uid,
   phone:auth.currentUser.phoneNumber,
   name:pName.value,
   city:pCity.value,
   category:pCategory.value,
   lat:p.coords.latitude,
   lng:p.coords.longitude,
   approved:false
  });
  alert("Profile saved. Approval pending");
 });
}

// ğŸ“ NEARBY + CALL / WHATSAPP
navigator.geolocation.getCurrentPosition(p=>{
 db.collection("workers")
 .where("approved","==",true)
 .onSnapshot(s=>{
  nearby.innerHTML="";
  s.forEach(d=>{
   let w=d.data();
   let div=document.createElement("div");
   div.className="worker";
   div.innerHTML=`
   <b>${w.name}</b><br>${w.category}<br>
   <div class="actions">
   <button class="call"
    onclick="location.href='tel:${w.phone}'">
    ğŸ“ Call</button>
   <button class="whatsapp"
    onclick="location.href=
    'https://wa.me/${w.phone.replace("+","")}?text=àª¨àª®àª¸à«àª¤à«‡ ${w.name}, àª•àª¾àª® àª®àª¾àªŸà«‡ àª¸àª‚àªªàª°à«àª•'">
    ğŸ’¬ WhatsApp</button>
   </div>`;
   nearby.appendChild(div);
  });
 });
});
</script>

</body>
</html>
